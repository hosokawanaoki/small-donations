version: "3"
services:
    strapi:
        container_name: strapi
        image: strapi/strapi:3.0.1
        restart: always
        environment:
            DATABASE_CLIENT: mongo
            DATABASE_NAME: strapi
            DATABASE_HOST: mongo
            DATABASE_PORT: 27017
            DATABASE_USERNAME: strapi
            DATABASE_PASSWORD: strapi
        links:
            - mongo:mongo
        volumes:
            - /workspace/small-donations/src/backend/app:/srv/app
        ports:
            - "1337:1337"
    mongo:
        container_name: mongo
        build:
            context: /workspace/small-donations/src/docker/mongo
        restart: always
        tty: true
        environment:
            MONGO_INITDB_ROOT_USERNAME: strapi
            MONGO_INITDB_ROOT_PASSWORD: strapi
        volumes:
            - mongodata:/data
        ports:
            - "27017:27017"
    express:
        container_name: mongo-express
        ports:
            - "8081:8081"
        restart: always
        links:
            - mongo:mongo
        environment:
            ME_CONFIG_MONGODB_ENABLE_ADMIN: "true"
            ME_CONFIG_MONGODB_PORT: 27017
            ME_CONFIG_MONGODB_ADMINUSERNAME: strapi
            ME_CONFIG_MONGODB_ADMINPASSWORD: strapi
        image: mongo-express
    nginx:
        build:
            context: /workspace/small-donations/src/docker/nginx
        container_name: nginx
        restart: always
        ports:
            - "80:80"
        volumes:
            - /workspace/small-donations/src/nginx/html:/app
            - /workspace/small-donations/src/nginx/setting:/setting
            - /workspace/small-donations/src/nginx/default.conf:/etc/nginx/conf.d/default.conf
volumes:
    mongodata:
